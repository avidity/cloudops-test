name: Deploy to Production

on:
  push:
    branches: [ main ]

jobs:
  deploy_job:
    name: Deploy to Production
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Build, tag, and push image to Amazon ECR
        id: build-image
        env:
          DOCKER_REGISTRY: ratuliit42
          DOCKER_REPOSITORY: avidity-app
          IMAGE_TAG: ${{ github.sha }}
        run: |
          docker build -t $DOCKER_REGISTRY/$DOCKER_REPOSITORY:$IMAGE_TAG .
          echo "::set-output name=image::$DOCKER_REGISTRY/$DOCKER_REPOSITORY:$IMAGE_TAG"
